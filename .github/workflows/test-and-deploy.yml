name: ğŸ¯ é©å‘½çš„è¦–ç·šè¿½è·¡ã‚·ã‚¹ãƒ†ãƒ  - ãƒ†ã‚¹ãƒˆ & ãƒ‡ãƒ—ãƒ­ã‚¤

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test-and-deploy:
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¦ ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
      uses: actions/checkout@v4
      
    - name: ğŸŸ¢ Node.jsç’°å¢ƒã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
      uses: actions/setup-node@v4
      with:
        node-version: '18'
        cache: 'npm'
        
    - name: ğŸ“¥ ä¾å­˜é–¢ä¿‚ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
      run: npm ci
      
    - name: ğŸ§ª ãƒªãƒ³ãƒˆãƒã‚§ãƒƒã‚¯å®Ÿè¡Œ
      run: npm run lint --if-present || echo "No lint script found"
      
    - name: ğŸ”¨ ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ãƒ“ãƒ«ãƒ‰å®Ÿè¡Œ
      run: npm run build
      
    - name: ğŸ“Š ãƒ“ãƒ«ãƒ‰çµæœã‚’ç¢ºèª
      run: |
        echo "ğŸ¯ ãƒ“ãƒ«ãƒ‰å®Œäº†ï¼ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºç¢ºèª:"
        ls -la dist/
        echo ""
        echo "ğŸ“± ãƒ¡ã‚¤ãƒ³ã‚¢ã‚»ãƒƒãƒˆ:"
        du -h dist/assets/*
        echo ""
        echo "ğŸ¯ é©å‘½çš„è¦–ç·šè¿½è·¡ã‚·ã‚¹ãƒ†ãƒ ã®ä¸»è¦ãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª:"
        grep -l "useAdvancedFaceAnalyzer\|useOpenCVFaceTracker" dist/assets/*.js || echo "JS files are minified"
        
    - name: ğŸš€ GitHub Pagesã«ãƒ‡ãƒ—ãƒ­ã‚¤
      if: github.ref == 'refs/heads/main'
      uses: peaceiris/actions-gh-pages@v3
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        publish_dir: ./dist
        
    - name: ğŸ“ ãƒ‡ãƒ—ãƒ­ã‚¤å®Œäº†é€šçŸ¥
      if: github.ref == 'refs/heads/main'
      run: |
        echo "ğŸ¯ é©å‘½çš„è¦–ç·šè¿½è·¡ã‚·ã‚¹ãƒ†ãƒ ãŒãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¾ã—ãŸï¼"
        echo "ğŸŒ URL: https://${{ github.repository_owner }}.github.io/${{ github.event.repository.name }}/"
        echo ""
        echo "âœ… å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½:"
        echo "  - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç”»åƒè§£æã«ã‚ˆã‚‹æ­£ç¢ºãªç›®æ¤œå‡º"
        echo "  - é¼»è¿½è·¡å•é¡Œã®è§£æ±º"
        echo "  - USBã‚«ãƒ¡ãƒ©å¯¾å¿œ"
        echo "  - è·é›¢è£œæ­£æ©Ÿèƒ½"
        echo "  - ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å®‰å…¨æ©Ÿèƒ½"